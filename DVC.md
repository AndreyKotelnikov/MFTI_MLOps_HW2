## Установка и использование DVC с MinIO

### 1. Установка Python (если не установлен)

1. Скачайте [Python для Windows](https://www.python.org/downloads/windows/) и установите его, отметив галочку "Add Python to PATH".

### 2. Установка DVC

Самый простой способ установить DVC — через `pip` (при условии, что Python уже установлен).

Откройте командную строку (CMD) или PowerShell и выполните:
```bash
pip install dvc[all]
```

Проверить установку можно командой:
```bash
dvc --version
```
Если всё прошло успешно, вы увидите версию DVC.

**Примечание:** `[all]` устанавливает все дополнительные зависимости для работы с разными типами хранилищ, включая s3-совместимые. Если вы хотите минимизировать зависимоти, можно установить `dvc[s3]`, но `dvc[all]` — более универсальный вариант.

## Настройка DVC в вашем проекте

### 1. Инициализация DVC

Перейдите в корневую директорию вашего проекта (там где `docker-compose.yml`) и выполните:
```bash
dvc init
```

После этого в проекте появится скрытая папка `.dvc` и файл `.dvcignore`.

### 2. Добавление файла датасета под контроль DVC

Предположим, у вас есть файл датасета, например `data.csv`, который вы хотите версионировать и хранить в MinIO. Поместите этот файл в корень проекта или в любую удобную для вас директорию (например `data/data.csv`).

Добавьте файл в DVC:
```bash
dvc add data/data.csv
```

В результате появится файл `data/data.csv.dvc`, который будет содержать метаданные о вашем файле, а сам `data.csv` будет добавлен в `.gitignore`, чтобы не попадать в Git напрямую.

### 3. Настройка удалённого хранилища (MinIO S3)

MinIO предоставляет S3-совместимый API, значит мы можем настроить `dvc remote` как для обычного S3. Вам понадобятся следующие данные:

- `endpointurl` (ендпоинт MinIO): `http://localhost:9000`
- `access_key_id`: `minio_user`
- `secret_access_key`: `minio_password`
- Название уже созданного bucket: `my-bucket`

Добавьте новый remote:
```bash
dvc remote add -d myremote s3://my-bucket
```

После этого в `.dvc/config` появится запись о remote `myremote`.

Теперь настроим дополнительные параметры для использования MinIO в качестве S3:
```bash
dvc remote modify myremote endpointurl http://localhost:9000
dvc remote modify myremote access_key_id minio_user
dvc remote modify myremote secret_access_key minio_password
dvc remote modify myremote use_ssl false
```

Обратите внимание, что `use_ssl false` важен, если вы не настроили HTTPS. 

### 4. Загрузка (push) файла в MinIO

После добавления датасета под контроль и настройки удалённого репозитория, можно отправить данные в MinIO:

```bash
dvc push
```

DVC найдёт все файлы, которые были добавлены через `dvc add`, и загрузит их в указанный удалённый хранилище `myremote` (MinIO).

Убедиться в успешной загрузке можно, зайдя в консоль MinIO и посмотрев в ваш bucket `my-bucket`.

### 5. Удаление локального файла (для проверки)

Предположим, вы хотите проверить, что действительно можете забрать файл обратно из MinIO. Можно удалить локальный файл `data/data.csv` (но оставить `data/data.csv.dvc`). Не трогайте `.dvc` директорию!

```bash
del data\data.csv
```

Теперь локально файла нет, но есть его метаданные `data.csv.dvc`.

### 6. Выгрузка (pull) файла обратно

Чтобы загрузить файлы обратно из MinIO в проект, используйте:

```bash
dvc pull
```

DVC найдёт отсутствующие файлы по их хэшам в удалённом хранилище и скачает обратно `data.csv`.

Если всё настроено верно, после этой команды ваш `data.csv` снова появится локально.

---

## Итог

Таким образом, последовательность шагов следующая:

1. **Установка DVC** на Windows через `pip`.
2. **Инициализация DVC** в вашем Git-проекте: `dvc init`.
3. **Добавление датасета** под контроль DVC: `dvc add data/data.csv`.
4. **Настройка удалённого хранилища** (MinIO как S3) с помощью `dvc remote add` и `dvc remote modify`.
5. **Загрузка файла в MinIO**: `dvc push`.
6. **Восстановление файла из MinIO**: `dvc pull` после удаления локального файла.

После выполнения всех этих шагов ваш файл будет храниться в MinIO, а DVC будет управлять версиями данных, позволяя легко выгружать и загружать нужные версии.